global_config:
  name: "root"
  canaries:
    - name: "GetHistory Workflow"
      condition:
        match:
          path: "metadata.client_context.Workflow"
          with_value: "gethistory"
      mutations:
        - filter:
            path: "dl_request_data.headers"
            to_value: "dl_request_data.headers[?!(contains(['CA_ADJ', 'HIST_CRNCY'], name))]"
      config:
          worker-parameters:
              dlj2_getbql_gethistory_bql_dataacq:
                  build_query:
                      batch_sizes:
                          field: 10000
                          security: 25
                          date: 10000
                  python_profiling:
                      disabled: ''
                  process_bql_dataframes:
                      process_single_bql_dataframe:
                          validate:
                              - skip_if_empty: {}
              standardize_ids_before_input_merge: true

    - name: "COFI"
      mutations:
        - filter:
            path: "dl_request_data.fields"
            to_value: "dl_request_data.fields[?fieldMetaData[?name=='dlCommercialModelCategory' && value == '89']]"
      config:
            worker-parameters:
                dlj2_getbql_gethistory_bql_dataacq:
                    build_query:
                        secondary_columns:
                            - "PERIOD"
                            - "PERIOD_END_DATE"
                            - "AS_OF_DATE"
                            - "CURRENCY"